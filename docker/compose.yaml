services:
  r-dev:
    build:
      context: ..
      dockerfile: docker/Dockerfile.r-dev
      args:
        USER_ID: ${UID:-1000}
        GROUP_ID: ${GID:-1000}
        USERNAME: ${USER:-dev}
    image: r-dev:local
    container_name: rwt-mind-palace
    hostname: rwt-mind-palace
    stdin_open: true
    tty: true
    restart: unless-stopped
    ports:
      - "9012:35211"  # httpgd
      - "9013:9013"   # quarto preview
    volumes:
      # Mount dotfiles (install.sh creates symlinks to these)
      - ~/dotfiles:/home/${USER:-dev}/dotfiles
      # Mount projects directory
      - ~/projects:/home/${USER:-dev}/projects
      # Mount ArgoAPI
      - /data/home/scott/projects/argoAPI:/home/${USER:-dev}/argoAPI:ro
      # Git/SSH config (read-only)
      - ~/.ssh:/home/${USER:-dev}/.ssh:ro
      - ~/.gitconfig:/home/${USER:-dev}/.gitconfig:ro
      - ~/.git-credentials:/home/${USER:-dev}/.git-credentials
      # Google auth tokens for gargle/googlesheets4/googledrive
      - ~/.secrets:/home/${USER:-dev}/.secrets
      # Persist tmux sessions across container restarts
      - r-dev-tmp:/tmp
    environment:
      - TERM=xterm-256color
      - TZ=America/Los_Angeles

  rstudio:
    image: rocker/tidyverse:4.5.2
    container_name: rstudio
    environment:
      - PASSWORD=${RSTUDIO_PASSWORD:-rstudio}
    ports:
      - "9010:8787"  # RStudio Server
    volumes:
      - ~/projects:/home/rstudio/projects
    restart: unless-stopped

volumes:
  r-dev-tmp:
